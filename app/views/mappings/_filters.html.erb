<nav class="filters row" data-module="filters">
  <div class="col-md-8">
    <div class="panel panel-default">
      <header class="panel-heading">
        <ul class="nav nav-compact nav-pills">
          <li class="if-no-js-hide nav-pill-text">
            <strong>Filter by</strong>
          </li>
          <li class="if-no-js-hide">
            <% if @path_contains.present? %>
              <%= filter_remove_option_link(@site, 'Path', :path_contains) %>
            <% else %>
              <%= filter_option_link(@site, 'Path') %>
              <div class="dropdown-menu dropdown-text-input" role="dialog" id="filter-by-path">
                <%= form_tag(site_mappings_path(@site), method: 'get', role: 'form', class: 'form') do %>
                  <%= render partial: 'mappings/filter/by_path', locals: {single_filter_form: true, button_text: 'Filter'} %>
                <% end %>
              </div>
            <% end %>
          </li>
          <li class="if-no-js-hide">
            <% if @new_url_contains.present? %>
              <%= filter_remove_option_link(@site, 'New URL', :new_url_contains) %>
            <% else %>
              <%= filter_option_link(@site, 'New URL') %>
              <div class="dropdown-menu dropdown-text-input" role="dialog" id="filter-by-new-url">
                <%= form_tag(site_mappings_path(@site), method: 'get', role: 'form', class: 'form') do %>
                  <%= render partial: 'mappings/filter/by_new_url', locals: {single_filter_form: true, button_text: 'Filter'} %>
                <% end %>
              </div>
            <% end %>
          </li>
          <% tags = most_used_tags_for_site(@site, limit: 10) %>
          <% if tags.any? %>
          <li class="if-no-js-hide">
            <%= filter_option_link(@site, 'Tag') %>
            <ul class="dropdown-menu" role="menu">
              <% tags.each do |tag| %>
                <li>
                  <%= link_to tag, filter_by_tag_path(tag), class: 'inherit' %>
                </li>
              <% end %>
            </ul>
          </li>
          <% end %>
          <li class="if-js-hide">
            <%= link_to 'Filter mappings', filter_site_mappings_path(@site) %>
          </li>
        </ul>
      </header>

      <% if @filtered %>
        <div class="panel-body">
          <% if @path_contains %>
            <%= form_tag(site_mappings_path(@site), method: 'get', role: 'form', class: 'form active-filter') do %>
              <%= render partial: 'mappings/filter/by_path', locals: {single_filter_form: true, button_text: 'Update path'} %>
            <% end %>
          <% end %>
          <% if @new_url_contains %>
            <%= form_tag(site_mappings_path(@site), method: 'get', role: 'form', class: 'form active-filter') do %>
              <%= render partial: 'mappings/filter/by_new_url', locals: {single_filter_form: true, button_text: 'Update URL'} %>
            <% end %>
          <% end %>
          <% if filtered_by_tags? %>
            <dl class="remove-bottom-margin filtered-tags">
              <dt class="add-label-margin">Tagged</dt>
              <dd>
                <ul class="remove-bottom-margin tag-list">
                <% filtered_by_tags.each do |tag| %>
                  <li>
                    <%= link_to remove_tag_from_filter_path(tag), class: 'tag', title: "Remove “#{tag}” tag filter" do %>
                      <span class="glyphicon glyphicon-remove"></span> <%= tag %>
                    <% end %>
                  </li>
                <% end %>
                </ul>
              </dd>
            </dl>
          <% end%>
        </div>
      <% end %>

    </div>
  </div>
</nav>
