<% content_for(:page_title, 'Preview import') %>

<% breadcrumb(:preview_import_mappings, @site, @batch) %>

<div class="page-title-with-border">
  <h1>
    <span class="small"><%= @site.default_host.hostname %></span>
    Preview import
  </h1>
</div>

<%= form_for [@site, @batch], url: import_site_import_batch_path(@site, @batch), role: 'form' do |f| %>
  <h4 class="add-bottom-margin">Running this import will</h4>
  <ul class="list-group">
    <li class="list-group-item">Create <%= pluralize(@redirect_count, 'new redirect') %></li>
    <li class="list-group-item">Create <%= pluralize(@archive_count, 'new archive') %></li>
    <li class="list-group-item">Create <%= pluralize(@unresolved_count, 'new unresolved mapping') %></li>
</li>
  </ul>

  <%= button_tag 'Import', class: 'btn btn-success add-big-bottom-margin' %>
  <%= link_to 'Cancel', site_path(@site), class: 'btn btn-default add-big-bottom-margin add-left-margin' %>
<% end %>

<h4 class="add-bottom-margin">Preview mappings (<%= @batch.entries.count %>)</h4>

<table class="mappings table table-bordered">
  <thead>
    <tr class="table-header">
      <th class="mapping-type-column" scope="col">Type</th>
      <th scope="col">
        Original path from <%= @site.default_host.hostname %>
      </th>
    </tr>
  </thead>
  <tbody>
  <% @batch.entries.each do |entry| %>
    <tr>
      <td class="<%= "mapping-type-#{entry.type}" %>">
        <% if entry.type == "unresolved" %>
          <span class="unresolved-type" title="No decision yet. Defaulting to archive." data-toggle="tooltip">Archive <span class="glyphicon glyphicon-question-sign unresolved-type-icon"></span></span>
        <% else %>
         <%= entry.type.titleize %>
        <% end %>
      </td>
      <td class="entry-path">
        <strong class="pull-left"><%= link_to entry.path, entry.old_url, class: 'breakable' %></strong>
        <% if entry.redirect? %>
          <br><span class="text-muted">will redirect to</span>
          <%= link_to entry.new_url, entry.new_url, class: 'link-muted breakable' if entry.new_url.present? %>
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>
